<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Christmas Tree (Version 1)</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: #000;
  overflow: hidden;
  font-family: sans-serif;
}

/* MAIN WRAPPER */
#app {
  position: absolute;
  inset: 0;
  width: 100vw;
  height: 100dvh; /* CHUẨN 100% CHIỀU CAO iPAD */
  max-width: 1620px;
  max-height: 2160px;
  margin: 0 auto;
  overflow: hidden;
}

/* BACKGROUND VIDEO */
#bgVideo {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover; /* hoặc contain if cần */
}

/* HOTSPOT */
.hotspot {
  transform: translate(-50%, -50%);
  position: absolute;
  width: 84px;
  height: 84px;
  cursor: pointer;
  border-radius: 50%;
  /* background: radial-gradient(
    circle,
    rgba(255,255,255,0.95) 0%,
    rgba(255,255,255,0) 60%
  );
  filter: blur(10px);
  animation: float 2.2s ease-in-out infinite; */
}

@keyframes float {
  0% { transform: translate(-50%, -50%) translateY(0) rotate(-2deg); }
  50% { transform: translate(-50%, -50%) translateY(-8px) rotate(2deg); }
  100% { transform: translate(-50%, -50%) translateY(0) rotate(-2deg); }
}

/* POPUP OVERLAY */
#popupOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 300;
}

#popupBox {
  position: relative;
  width: 100vw;
  height: 100vh;
  max-width: 1620px;
  max-height: 2160px;
  display: flex;
  justify-content: center;
  align-items: center;
}

/* CLOSE BUTTON */
#closeBtn {
  position: absolute;
  top: 40px;
  right: 40px;
  width: 80px;
  height: 80px;
  background: rgba(0,0,0,0.75);
  border: 3px solid #fff;
  color: #fff;
  border-radius: 50%;
  font-size: 36px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 400;
}

/* POPUP VIDEO */
#popupVideo {
  width: auto;
  height: 100%;
  object-fit: contain;
  z-index: 10;
}
  
/* TEXT */
.popupText {
  position: absolute;
  inset: 0;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  z-index: 50;
  pointer-events: none;

  /* responsive font size */
  font-size: clamp(28px, 4vw, 46px);
  line-height: 1.15;
  font-weight: 700;
  color: #000;
}

/* SNOW */
.snowflake {
  position: absolute;
  top: -10px;
  background: white;
  border-radius: 50%;
  opacity: 0.8;
  filter: drop-shadow(0 0 6px rgba(255,255,255,0.6));
  animation: fall linear infinite;
}

@keyframes fall {
  0% { transform: translateY(-20px); opacity: 0.3; }
  50% { opacity: 1; }
  100% { transform: translateY(110vh); opacity: 0.3; }
}

/* FIREWORK PARTICLE */
.particle {
  position: absolute;
  border-radius: 50%;
  opacity: 1;
  width: 12px;
  height: 12px;
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.9));
  transform: translate(0, 0) scale(0.4);
  animation: explode 1.2s ease-out forwards;
  will-change: transform, opacity;
}

@keyframes explode {
  0% {
    transform: translate(0, 0) scale(0.4);
    opacity: 1;
  }
  70% {
    opacity: 1;
  }
  100% {
    transform: translate(var(--tx, 0px), var(--ty, 0px)) scale(1.2);
    opacity: 0;
  }
}
/* =========================================================
   ==============    MOBILE ≤ 768px    =====================
========================================================= */
@media (max-width: 767px) {
  #bgVideo,
  #popupVideo {
    width: 100%;
    height: 100%;
    object-fit: contain !important; /* Giữ nguyên tỉ lệ, không crop 2 bên */
    background: #000; /* giúp top/bottom có màu đen */
  }

  #app {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  }

  #popupBox {
    width: 100vw;
    height: 100vh;
    background: #000;
  }
  .hotspot {
    width: 80px;
    height: 80px;
  }
  .popupText {
    font-size: clamp(20px, 3vw, 35px);
  }
  #closeBtn {
    position: absolute;
    width: 50px;
    height: 50px;
    top: 180px;
    right: 20px;
    border-width: 3px;
    font-size: 30px;
  }
}
/* =========================================================
   ==============   768px ≤ TABLET ≤ 1024px    =====================
========================================================= */
@media (min-width: 768px) and (max-width: 1024px) {
  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    width: 72px;
    height: 72px;
    font-size: 32px;
  }

  .popupText {
    /* font-size: clamp(30px, 4vw, 454545); */
    font-size: 42px !important; 
    line-height: 1.30;
  }
}
/* =========================================================
   LAPTOP 1025px → 1366px
========================================================= */
@media (min-width: 1025px) and (max-width: 1366px) {
  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }
  
  .popupText {
    font-size: clamp(30px, 3vw, 35px);
  }
}
/* =========================================================
   PC 1367px → 1919px
========================================================= */
@media (min-width: 1367px) and (max-width: 1919px) {
  .hotspot {
    width: 130px;
    height: 130px;
    filter: blur(12px);
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }

  .popupText {
    font-size: clamp(30px, 2.5vw, 40px);
    line-height: 1.1;
  }
}
/* =========================================================
   DESKTOP ≥ 1920px
========================================================= */
@media (min-width: 1920px) {
  #app {
    max-width: 1800px;
    max-height: 2400px;
  }

  .hotspot {
    width: 130px;
    height: 130px;
  }

  #closeBtn {
    position: absolute;
    width: 76px;
    height: 76px;
    top: 30px;
    right: 475px;
    border-width: 3px;
    font-size: 30px;
  }

  .popupText {
    font-size: clamp(30px, 2vw, 50px);
  }
}
/* =========================================================
   VIDEO FIX CHUNG — ÁP DỤNG CHO TẤT CẢ ≥ 1024px
   Video luôn vào giữa, không crop, thừa hai bên trái/phải OK
========================================================= */
@media (min-width: 1025px) {
  #bgVideo {
    width: auto !important;
    height: 100% !important;
    object-fit: contain !important;
    background: #000;
    display: block;       /* để margin auto hoạt động */
    margin: 0 auto;       /* căn giữa trái phải */
  }

  #popupVideo {
    width: auto !important;
    height: 100% !important;
    object-fit: contain !important;
    background: #000;
    display: block;
    margin: 0 auto;
  }

  #app {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #000;
  }
}

</style>
</head>
  
<body>
  
<div id="app">
  <video id="bgVideo"
    src="https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765425321/BocTham_1620x1954_-_Testcode_haxvzm.mp4"
    autoplay loop muted playsinline>
  </video>
</div>

<!-- POPUP -->
<div id="popupOverlay">

  <div id="popupBox">
    <div id="closeBtn">✕</div>

    <video id="popupVideo"
      src="https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765272670/1209_djpeju.mp4" 
      /* src="https://res.cloudinary.com/ddcbvgrxw/video/upload/v1765425321/BocTham_1620x1954_-_Testcode_haxvzm.mp4" 
      autoplay loop muted playsinline >*/ 
    </video>

    <!-- TEXT LAYERS -->
    <div class="popupText" id="text1">Bạn đã trúng<br>01 gối Kymdan<br>PressureFree Air</div>
    <div class="popupText" id="text2">Bạn đã trúng<br>01 gối Kymdan<br>Glory Air</div>
    <div class="popupText" id="text3">Bạn đã trúng<br>01 gối Kymdan<br>PressureFree Max</div>
    <div class="popupText" id="text4">Bạn đã trúng<br>01 gối Kymdan<br>PressureFree Plus</div>
    <div class="popupText" id="text5">Bạn đã trúng<br>01 bộ ga Kymdan<br>Lavish Prime</div>
    <div class="popupText" id="text6">Bạn đã trúng<br>01 bộ ga Kymdan<br>Serenity</div>
    <div class="popupText" id="text7">Bạn đã trúng<br>01 mền chăn Kymdan<br>SleepCool</div>

  </div>
</div>

<script>
/* =====================================================
      HOTSPOTS
===================================================== */
const ornamentPositions = [
  { id: 1, x: "50%", y: "13%" },
  { id: 2, x: "50%", y: "29%" },
  { id: 3, x: "62%", y: "43%" },
  { id: 4, x: "37%", y: "51%" },
  { id: 5, x: "70%", y: "62%" },
  { id: 6, x: "27%", y: "68%" },
  { id: 7, x: "47%", y: "70%" },
];

const app = document.getElementById("app");

ornamentPositions.forEach(pos => {
  const dot = document.createElement("div");
  dot.className = "hotspot";
  dot.style.left = pos.x;
  dot.style.top = pos.y;
  dot.onclick = () => openPopup(pos.id);
  app.appendChild(dot);
});

/* =====================================================
      POPUP
===================================================== */
let autoCloseTimeout = null;
  
const popupOverlay = document.getElementById("popupOverlay");
const closeBtn = document.getElementById("closeBtn");
  
closeBtn.onclick = closePopup;

function openPopup(id) {
  // clear previous auto-close (important when user opens/close fast)
  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  // ensure popup visible
  popupOverlay.style.display = "flex";

  // reset text layers
  document.querySelectorAll(".popupText").forEach(t => t.style.display = "none");
  const text = document.getElementById("text" + id);
  if (text) text.style.display = "flex";

  // restart fireworks safely (stop any running ones first)
  stopFireworks();
  startFireworks();

  // set auto-close for 15s (will be cleared if user reopens or closes)
  autoCloseTimeout = setTimeout(() => {
    // clear ref first then close
    autoCloseTimeout = null;
    closePopup();
  }, 15000);
}


function closePopup() {
  // hide popup
  popupOverlay.style.display = "none";

  // clear auto-close timer if exists
  if (autoCloseTimeout) {
    clearTimeout(autoCloseTimeout);
    autoCloseTimeout = null;
  }

  // stop fireworks immediately
  stopFireworks();
}


/* =====================================================
      SNOW EFFECT
===================================================== */
function generateSnow() {
  for (let i = 0; i < 48; i++) {
    const flake = document.createElement("div");
    flake.className = "snowflake";
    flake.style.left = Math.random() * 100 + "%";
    flake.style.width = flake.style.height = 6 + Math.random() * 8 + "px";
    flake.style.animationDuration = 6 + Math.random() * 6 + "s";
    flake.style.animationDelay = Math.random() * 6 + "s";
    document.body.appendChild(flake);
  }
}
generateSnow();

/* =====================================================
      FIREWORKS (LIGHTWEIGHT)
===================================================== */
/* =====================================================
      FIREWORKS (VISIBLE & LONGER DURATION)
===================================================== */
/* =====================================================
      FIREWORKS — continuous for 7 seconds
===================================================== */
/* FIREWORKS — visible, no left-column artifact, lasts 7s */
/* =====================================================
      FIREWORKS — Full working version
===================================================== */

let fwInterval = null;
let fwTimeout = null;

function startFireworks() {
  stopFireworks(); // xoá mọi thứ cũ trước

  const container = document.createElement("div");
  container.id = "fireworks-container";
  container.style.position = "fixed";
  container.style.inset = "0";
  container.style.pointerEvents = "none";
  container.style.zIndex = "99999";
  document.body.appendChild(container);

  // BẮT ĐẦU bắn pháo mỗi 300ms
  fwInterval = setInterval(() => makeBurst(container), 300);

  // TỰ TẮT sau 7 giây
  fwTimeout = setTimeout(() => {
    stopFireworks();
  }, 7000);
}

function stopFireworks() {
  if (fwInterval !== null) {
    clearInterval(fwInterval);
    fwInterval = null;
  }
  if (fwTimeout !== null) {
    clearTimeout(fwTimeout);
    fwTimeout = null;
  }

  const old = document.getElementById("fireworks-container");
  if (old) old.remove();
}

function makeBurst(container) {
  // tránh bắn sát mép màn hình
  const bx = 6 + Math.random() * 88;
  const by = 12 + Math.random() * 56;

  for (let i = 0; i < 28; i++) {
    const p = document.createElement("div");
    p.className = "particle";

    const angle = Math.random() * Math.PI * 2;
    const speed = 100 + Math.random() * 160;

    const tx = Math.cos(angle) * speed;
    const ty = Math.sin(angle) * speed;

    p.style.left = bx + "%";
    p.style.top = by + "%";
    p.style.background = `hsl(${Math.floor(Math.random() * 360)}, 90%, 60%)`;
    p.style.setProperty("--tx", tx + "px");
    p.style.setProperty("--ty", ty + "px");

    container.appendChild(p);

    setTimeout(() => p.remove(), 1400);
  }
}
function getVideoMetrics() {
  const video = document.getElementById("bgVideo");
  const container = document.getElementById("app");

  const videoRatio = video.videoWidth / video.videoHeight;
  const containerRatio = container.offsetWidth / container.offsetHeight;

  let displayWidth, displayHeight, offsetX, offsetY;

  if (videoRatio > containerRatio) {
    // Video quá rộng → fit theo chiều rộng container
    displayWidth = container.offsetWidth;
    displayHeight = displayWidth / videoRatio;
    offsetX = 0;
    offsetY = (container.offsetHeight - displayHeight) / 2;
  } else {
    // Video quá cao → fit theo chiều cao container
    displayHeight = container.offsetHeight;
    displayWidth = displayHeight * videoRatio;
    offsetX = (container.offsetWidth - displayWidth) / 2;
    offsetY = 0;
  }

  return { displayWidth, displayHeight, offsetX, offsetY };
}
function updateHotspotPositions() {
  const { displayWidth, displayHeight, offsetX, offsetY } = getVideoMetrics();

  ornamentPositions.forEach((pos, index) => {
    const dot = document.getElementsByClassName("hotspot")[index];

    const x = (parseFloat(pos.x) / 100) * displayWidth + offsetX;
    const y = (parseFloat(pos.y) / 100) * displayHeight + offsetY;

    dot.style.left = x + "px";
    dot.style.top = y + "px";
  });
}
bgVideo.addEventListener("loadedmetadata", updateHotspotPositions);
window.addEventListener("resize", updateHotspotPositions);

</script>
</body>
</html>
